### **第五章：运输层**

**🚀 进程间的桥梁：可靠传输与流量控制**

------

#### 1. 运输层协议概述

**📌 核心角色**

> *“运输层：应用进程的信使”* ，屏蔽网络层复杂性，提供端到端逻辑通信信道。 

**📊 UDP vs TCP对比矩阵**

| **特性** | **UDP**       | **TCP**       |
| -------- | ------------- | ------------- |
| 连接性   | 无连接        | 面向连接      |
| 可靠性   | 不可靠        | 可靠交付      |
| 传输模式 | 面向报文      | 面向字节流    |
| 适用场景 | 实时视频/广播 | 文件传输/网页 |

**🛠 端口号分类实验**

- 熟知端口：0-1023（HTTP:80, HTTPS:443）  
- 登记端口：1024-49151（自定义服务）  
- 短暂端口：49152-65535（客户端临时使用）  

#### 2. 用户数据报协议 UDP

**🔵 UDP首部结构**

源端口（2B） | 目的端口（2B） | 长度（2B） | 校验和（2B）  
伪首部（12B临时添加）：IP源 | IP目的 | 协议 | UDP长度  

**📌 校验和计算案例**
数据：`0x1234`, 伪首部：`0xABCD` → 校验和：`0xE5F6`（示例）

------

#### 3. 传输控制协议 TCP

**📌 TCP连接端点**
套接字格式：`IP地址:端口号`
示例：`203.179.1.100:8080` ↔ `192.168.1.101:49152`

------

#### 4. 可靠传输原理

**📊 ARQ协议对比**

| **协议** | **信道利用率**   | **复杂度** |
| -------- | ---------------- | ---------- |
| 停止等待 | 低（单分组）     | 简单       |
| 连续ARQ  | 高（窗口多分组） | 中等       |

**🛠 滑动窗口演示**
发送窗口大小：`4个分组`
发送序列：`1,2,3,4` → 收到确认`ACK2` → 窗口滑动至`2,3,4,5`

------

#### 5. TCP报文段首部

**🔵 首部字段解析**

源端口 | 目的端口 | 序号 | 确认号 | 数据偏移 | URG/ACK等标志  
窗口大小 | 校验和 | 紧急指针 | 选项（如MSS）  

**📌 MSS协商案例**
客户端提议：`MSS=1460` → 服务器确认 → 有效MSS=1460

------

#### 6. TCP可靠传输实现

**📌 自适应RTO计算**
初始RTO：`1秒` → 测量RTT后动态调整，避免固定超时

**🛠 SACK示例**
接收方报文：`ACK100 + SACK120-150` → 重传缺失数据`101-119`

------

#### 7. TCP流量控制

**🔵 死锁解决机制**
接收方窗口=0 → 发送方触发持续计时器 → 定期探测窗口恢复

**📊 Nagle算法效果**
小数据累积 → 单报文发送 ✅ 减少糊涂窗口

------

#### 8. TCP拥塞控制

**📌 四阶段算法**

1. **慢开始** ：窗口指数增长
2. **拥塞避免** ：窗口线性增长
3. **快重传** ：3重复ACK触发
4. **快恢复** ：直接重置窗口

**🛠 拥塞窗口调整曲线**

窗口增长：1 → 2 → 4 → 8（慢开始） → 9（避免） → 降半后恢复  

#### 9. TCP连接管理

**📌 三握手建立流程**

客户端 → SYN → 服务器  
服务器 → SYN+ACK → 客户端  
客户端 → ACK → 连接建立  

**🛠 有限状态机变迁图**

CLOSED → SYN_SENT → ESTABLISHED → DATA → CLOSING  

**💻 章节测试题**
**Q1** ：TCP连接端点由什么组成？
答案：套接字（IP+端口） ✅

**Q2** ：UDP校验和计算包含哪些部分？
答案：首部+数据+伪首部 ✅
